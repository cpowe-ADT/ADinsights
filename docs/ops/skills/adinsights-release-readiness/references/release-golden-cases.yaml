cases:
  - name: green packets and artifacts pass
    input:
      prompt: 'Release readiness check'
      scope_packet:
        scope_status: PASS_SINGLE_SCOPE
        required_reviewers: []
        required_tests_by_folder: {}
      contract_packet:
        contract_status: PASS_NO_CONTRACT_CHANGE
        breaking_change_detected: false
        required_tests: []
        required_docs_updates: []
        required_reviewers: []
      changed_files:
        - docs/runbooks/release-checklist.md
        - docs/runbooks/deployment.md
        - docs/runbooks/operations.md
        - docs/project/api-contract-changelog.md
        - docs/project/integration-data-contract-matrix.md
    expect:
      release_status: GATE_PASS

  - name: cross-scope unresolved warns
    input:
      prompt: 'Release readiness check'
      scope_packet:
        scope_status: ESCALATE_CROSS_SCOPE
        required_reviewers:
          - Raj
        required_tests_by_folder: {}
      contract_packet:
        contract_status: PASS_NO_CONTRACT_CHANGE
        breaking_change_detected: false
        required_tests: []
        required_docs_updates: []
        required_reviewers: []
    expect:
      release_status: GATE_WARN
      required_approvers_contains:
        - Raj

  - name: breaking contract blocks release
    input:
      prompt: 'Release readiness check'
      scope_packet:
        scope_status: PASS_SINGLE_SCOPE
        required_reviewers: []
        required_tests_by_folder: {}
      contract_packet:
        contract_status: ESCALATE_BREAKING_CHANGE
        breaking_change_detected: true
        required_tests: []
        required_docs_updates: []
        required_reviewers:
          - Raj
          - Mira
    expect:
      release_status: GATE_BLOCK
      required_approvers_contains:
        - Raj
        - Mira

  - name: pending tests and docs remain informational
    input:
      prompt: 'Release readiness check'
      scope_packet:
        scope_status: PASS_SINGLE_SCOPE
        required_reviewers: []
        required_tests_by_folder:
          frontend:
            - cd frontend && npm ci && npm test -- --run && npm run build
        required_docs_updates:
          - docs/ops/agent-activity-log.md
      contract_packet:
        contract_status: PASS_NO_CONTRACT_CHANGE
        breaking_change_detected: false
        required_tests: []
        required_docs_updates: []
        required_reviewers: []
    expect:
      release_status: GATE_PASS
      pending_items_contains:
        - Run and verify required tests before release.
        - Complete required documentation updates before release.

  - name: missing required artifacts warns
    input:
      prompt: 'Release readiness check'
      scope_packet:
        scope_status: PASS_SINGLE_SCOPE
        required_reviewers: []
        required_tests_by_folder: {}
      contract_packet:
        contract_status: PASS_NO_CONTRACT_CHANGE
        breaking_change_detected: false
        required_tests: []
        required_docs_updates: []
        required_reviewers: []
      artifact_presence_override:
        docs/runbooks/release-checklist.md: false
        docs/runbooks/deployment.md: false
    expect:
      release_status: GATE_WARN

  - name: failing optional checks blocks
    input:
      prompt: 'Release readiness check'
      scope_packet:
        scope_status: PASS_SINGLE_SCOPE
        required_reviewers: []
        required_tests_by_folder: {}
      contract_packet:
        contract_status: PASS_NO_CONTRACT_CHANGE
        breaking_change_detected: false
        required_tests: []
        required_docs_updates: []
        required_reviewers: []
      run_checks: true
      forced_check_results:
        - id: production_readiness
          command: python3 infrastructure/airbyte/scripts/verify_production_readiness.py
          gate_dimension: test_coverage
          block_on_failure: true
          ok: false
          exit_code: 1
          output: 'simulated failure'
    expect:
      release_status: GATE_BLOCK
