name: dbt

on:
  push:
    paths:
      - "dbt/**"
      - ".github/workflows/dbt.yml"
  workflow_dispatch:

jobs:
  run-dbt:
    runs-on: ubuntu-latest
    timeout-minutes: 30

    # If you want a temp dir as an env var at the JOB level, compute it with an expression here.
    env:
      DBT_TEMP_DIR: ${{ runner.temp }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dbt (core + postgres as example)
        run: |
          python -m pip install --upgrade pip
          pip install "dbt-core>=1.7,<2.0" "dbt-postgres>=1.7,<2.0"

      # Demonstrate safe use of the runner temp in a shell (via $RUNNER_TEMP):
      - name: Prepare temp working directory
        run: |
          echo "RUNNER_TEMP is: $RUNNER_TEMP"
          mkdir -p "$RUNNER_TEMP/dbt"
          echo "hello" > "$RUNNER_TEMP/dbt/probe.txt"
          ls -la "$RUNNER_TEMP/dbt"

      # If you actually have dbt project in ./dbt
      - name: Run dbt debug (optional)
        working-directory: ./dbt
        run: |
          dbt --version
          dbt debug || true
